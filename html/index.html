<html>
  <head>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet" type="text/css">
    <link rel="icon" type="image/png" href="ghdashboard-favicon.png" />
    <title>R10K Dashboard</title>
  </head>
  <body>
    <div id="header">
      <a href="javascript:dash.sortByState();"><i class="fa fa-sort-amount-desc fa-2x" title="Sort by state"></i></a>
      <a href="javascript:dash.refreshList();"><i class="fa fa-refresh fa-2x" title="Refresh list"></i></a>
      <a id="auth_link_priv" href="javascript:window.open('https://github.com/login/oauth/authorize?client_id=YOUR_CLIENT_ID&scope=repo');" style="display:none"><i class="fa fa-lock fa-2x" title="Allow access to Github private repositories"></i></a>
      <a id="auth_remove" style="display:none;" href="javascript:dash.authRemove();"><i class="fa fa-sign-out fa-2x" title="Sign out"></i></a>
      <br />
      <div id='total'></div>
      <div id='total_score'></div>
    </div>
    <div id="auth_link" style="position:absolute;z-index:99;margin:0 auto; width:800px; height:300px; background: white; text-align: center;">
      <a href="javascript:window.open('https://github.com/login/oauth/authorize?client_id=YOUR_CLIENT_ID');">
        <img src="https://github.githubassets.com/images/modules/open_graph/github-octocat.png" width="400" /><br />
        Sign in with Github <i class="fa fa-sign-in fa-2x" title="Sign in with Github"></i>
      </a>
    </div>
    <div class="jumbotron">
      <p>
      This dashboard analyses the Puppetfile from a Puppet control repository and displays information on the modules listed in it.
      </p>
      <p>
      The columns indicate:
      <ul>
        <li>Whether the repository is private on GitHub</li>
        <li>The pinned version of the module in the Puppetfile (on the Forge or GitHub)</li>
        <li>The latest available version of the module (on the Forge or GitHub)</li>
        <li>The number of Pull Requests open</li>
        <li>The number of Issues open</li>
        <li>The build status on Travis CI</li>
        <li>The kind of endorsement on the Forge</li>
      </ul>
      </p>
      <p>
      In order to get started:
      <ul>
        <li>Allow the application to access GitHub by clicking the Octocat icon</li>
        <li>Allow the application to access private GitHub repositories by clicking the lock icon</li>
      </ul>
      </p>
    </div>
    <table id='repositories'>
      <thead>
        <tr>
          <th>Module name</th>
          <th class="plugin:priv"><i class="fa fa-lock" title="Private"></i></th>
          <th class="plugin:pinned_version"><i class="fa" title="Pinned">Pin</i></th>
          <th class="plugin:latest_version"><i class="fa" title="Latests">Latest</i></th>
          <th class="plugin:pulls sorttable_numeric"><i class="fa fa-code" title="Pull Requests"></i></th>
          <th class="plugin:issues sorttable_numeric"><i class="fa fa-bug" title="Issues"></i></th>
          <th class="plugin:travis sorttable_numeric"><i class="fa fa-cogs" title="Travis CI build"></i></th>
          <th class="plugin:endorsement sorttable_numeric"><i class="fa fa-star" title="Endorsement"></i></th>
	        <!-- last column is for state+refresh -->
          <th class="sorttable_numeric"></th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>

    <script src="lib/sorttable.js"></script>
    <script type="module">
function getParameterByName(name) {
  name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
  var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
      results = regex.exec(location.search);
  return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}

var org = getParameterByName('org') || '<YOUR_GITHUB_ORG>';
var r10k_repo = getParameterByName('r10k_repo') || '<YOUR_R10K_REPO>';
var filter = getParameterByName('filter') || '.';

import { PuppetDashboard } from "./r10k_dashboard.js"

var dash = new PuppetDashboard({
  org: org,
  r10k_repo: r10k_repo,
  filter: filter,
  autoload: true
});
document.title = 'R10k report for '+org;
    </script>
  </body>
</html>
